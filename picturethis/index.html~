<!DOCTYPE html>
<html>
  <head>
    <title>picture this.</title>
    <style type="text/css">
      * { margin:0; padding:0;}
      body{
        background:#242222;
        color:#DBDBDB;
        font-family:"Helvetica Neue", Helvetica, arial, sans-serif;
        font-weight:normal;
      }
      .meta {
        background:#eee;
        position: absolute;
        opacity:0.85;
        bottom:-35px;
        right:0;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        padding:.25em;
        text-align:right;
        width:95%;
        font-size:90%;
      }
      .meta a img { margin-bottom:-3px;}
      a:link, a:visited {
        text-decoration:none;
        color:#FF297E;
        text-shadow: #ccc 2px -1px 2px;
      }
      a:hover {

      }
      h1 { font-size:20px; font-weight:normal; }
      h1 span { font-weight:bold; font-size:90%;}
      #container { width:900px; margin:1em auto;}
      #photos { list-style:none; }
      #photos li {
        position:relative;
        float:left; margin:.25em;
        overflow:hidden;
        padding: 5px;
        width: 150px;
        height: 150px;
        background: #EEE;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        -moz-box-shadow: 0 0 5px #ccc;
        -webkit-box-shadow: 0 0 5px #ccc;
        box-shadow:  0 0 5px #ccc;
      }
      #photos li span {
          display: block;
          height: 150px;
          max-height: 150px;
          overflow: hidden;
      }
      #photos li img.pho {
          max-width: 150px;
          overflow: hidden;
          width: 150px;
      }
      #mup {
          bottom:0;
          left:0;
          padding:1em;
          position:absolute;
      }
      .clearfix:after {
          content: ".";
          clear: both;
          display: block;
          height: 0;
          visibility: hidden;
      }
      #big-question { font-size: 550%; }
      #big-question span { font-weight:bold; }
    </style>
    <link rel="stylesheet" type="text/css" href="facebox.css" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
    <script type="text/javascript" src="facebox.js"></script>
  </head>
  <body>
    <div id="container" class="clearfix">
      <h1>Picture this <span>...</span></h1>
      <p id="big-question">What does going <span>offline</span> with strangers look like?</p>
      <ul id="photos"></ul>
    </div>
    <div id="mup">
      <a href="http://meetup.com/api" target="_blank"><img alt="Meetup API" src="http://meetup.github.com/stream/map/meetupapi.png"/></a>
    </div>
    <script type="text/javascript">
      (function($){
          $(function() {

              $("#photos li").live('click', function() {
                  var big = $(this).data().photo_link;
                  $.facebox({image: big});
              });
              var mu = new WebSocket("ws://stream.meetup.com/2/photos");

              mu.onmessage = function(m) {
                  if($("#big-question").is(":visible")) {
                   $("#big-question").slideUp("slow");
                  }
                  var photo = $.parseJSON(m.data);
                  var p = $([
                      '<li><span><a href="#"><img alt="Meetup Photo" class="pho" src="'
                      , photo.photo_link
                      , '"/></a></span>'
                      , '<div class="meta"><a href="http://meetup.com/'
                      , photo.photo_album.group.urlname
                      , '/photos/'
                      , photo.photo_album.photo_album_id
                      ,'/'
                      , photo.photo_id
                      , '" target="_blank">'
                      , '<img src="comment.png"/> on Meetup'
                      ,'</a></div></li>'].join('')
                  );
                  p.data(photo);
                  p.hover(function() {
                      $("h1 span").fadeOut("slow").text(
                              [photo.member.name
                               , " with "
                               , photo.photo_album.group.name].join('')
                      ).fadeIn("slow");
                      if(p.find(".meta").is(":visible")) {
                          p.find(".meta").animate({"bottom":"+=40"});
                      }
                  }
                  , function() {
                      $("h1 span").empty();
                      p.find(".meta").animate({"bottom":"-=40"});
                  });
                  p.hide();
                  p.find("img").load(function(){
                      if($("#container").height() + 150 < screen.height) {
                          $("#photos").append(p);
                          p.fadeIn("slow");
                      } else {
                          var all = $("#photos").children()
                          , l = all.size()
                          , c = all[Math.floor(Math.random() * l)];
                          $(c).fadeOut("slow", function() {
                              $(this).replaceWith(p);
                          });
                          p.fadeIn("slow");
                      }
                  });
              };
          });
      })(jQuery);
    </script>
  </body>
</html>