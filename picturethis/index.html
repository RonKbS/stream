<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="description" content="What does going offline with strangers look like?" />
    <title>picture this.</title>
    <link rel="stylesheet" type="text/css" href="picturethis.css"/>
    <link rel="stylesheet" type="text/css" href="facebox.css" />
    <!--[if IE]>
    <style type="text/css">
     #info {
       background:transparent;
       filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000050,endColorstr=#99000050);
       zoom: 1;      
      }
    </style>
    <![endif]-->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
    <script type="text/javascript" src="../js/mu.js"></script>
    <script type="text/javascript" src="facebox.js"></script>
  </head>
  <body>
    <div id="container" class="clearfix">
      <h1>Picture this <span>...</span></h1>
      <p id="big-question">What does going <span>offline</span> with strangers look like?</p>
      <ul id="photos" class="clearfix"></ul>
    </div>

    <div id="mup">
      <a class="muapi" href="http://meetup.com/api" target="_blank">
        <img alt="Meetup API" src="http://meetup.github.com/stream/map/meetupapi.png"/>
      </a>
       <a href="http://twitter.com/MeetupAPI" data-link-color="FF297E" data-text-color="ffffff" class="twitter-follow-button">Follow @MeetupAPI</a>
       <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    </div>
    <div id="info">
      &uarr; The photos above are shown <strong>live</strong> as they are uploaded to public <a href="http://meetup.com"><strong>Meetup</strong></a> groups &uarr;
    </div>
    <script type="text/javascript">
    (function($) {
      $(function() {
        $("#photos li").live('click', function() {
          var big = $(this).data().photo_link;
          $.facebox({image: big});
        });
        var queue = []
        , poll = function() {
           var photo = queue.shift();
           if(photo) {

              if($("#big-question").is(":visible")) { $("#big-question").slideUp("slow"); }

               var p = $([
                 '<li><span><a href="#"><img alt="Meetup Photo" class="pho" src="'
                 , photo.photo_link
                 , '"/></a></span>'
                 , '<div class="meta"><a title="comment" href="http://meetup.com/'
                 , photo.photo_album.group.urlname
                 , '/photos/'
                 , photo.photo_album.photo_album_id
                 , '/'
                 , photo.photo_id
                 , '" target="_blank">'
                 , '<img src="comment.png"/> on Meetup'
                 , '</a></div></li>'].join('')
               );

                p.data(photo);

                p.hover(function() {
                  var what = photo.photo_album.event ?
                  [photo.member.name
                  , " at "
                  , photo.photo_album.event.name
                  , " with "
                  , photo.photo_album.group.name].join('')
                  : [photo.member.name
                  , " with "
                  , photo.photo_album.group.name].join('');
                 $("h1 span").text(what);
                 var meta = p.find("div.meta");
                 if(meta.is(":visible")) {
                   meta.animate({"bottom":"+=35"});
                 }
              }
             , function() {
               $("h1 span").empty();
               p.find("div.meta").animate({"bottom":"-=35"});
             });

             p.find("img.pho").load(function(){
                 var photos = $("#photos")
                 , all = photos.children();
                 if(photos.height() + 159 > window.innerHeight) {
                     var perRow = Math.floor(photos.width() / 159);
                     if(all.size() % perRow === 0) { /* recycle */
                         var c = all[Math.floor(Math.random() * all.size())];
                         $(c).fadeOut(1000, function() {
                             $(this).replaceWith(p.fadeIn(500));
                         });
                     } else { /* final row */
                         photos.append(p.fadeIn(500));
                     }
                 } else {
                     photos.append(p.fadeIn(500));
                 }
             });
           } /* else no photo */
         };

         var go = function() {
           setInterval(poll, 3000);
         };
         mu.Photos(function(photo) { queue.push(photo); });
         setTimeout(go, 2500);
      });
    })(jQuery);
    </script>
  </body>
</html>